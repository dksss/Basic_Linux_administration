# Операционные системы UNIX/Linux (Базовый).
1. [Установка ОС](#Part_1)
2. [Создание пользователя](#Part_2)
3. [Настройка сети ОС](#Part_3)
4. [Обновление ОС](#Part_4)
5. [Использование команды sudo](#Part_5)
6. [Установка и настройка службы времени](#Part_6)
7. [Установка и использование текстовых редакторов](#Part_7)
8. [Установка и базовая настройка сервиса SSHD](#Part_8)
9. [Установка и использование утилит top, htop](#Part_9)
10. [Использование утилиты fdisk](#Part_10)
11. [Использование утилиты df](#Part_11)
12. [Использование утилиты du](#Part_12)
13. [Установка и использование утилиты ncdu](#Part_13)
14. [Работа с системными журналами](#Part_14)
15. [Использование планировщика заданий CRON](#Part_15)

## Part 1. Установка ОС <a name="Part_1"></a>
Чтобы узнать версию Ubuntu вводим команду:
`
cat /etc/issue
`

![Вывод команды](../misc/screenshots/part1.PNG)

## Part 2. Создание пользователя <a name="Part_2"></a>
Для создания пользователя служит команда *useradd*. 

Создаем пользователя, отличного от созданного при установке и добавляем его в группу **adm**

![Скриншот команды для создания пользователся](../misc/screenshots/Part2_1.PNG)

Проверяем создание нового пользователя в указанной группе:

![Новый пользователь в последней строке вывода команды](../misc/screenshots/Part2_2.PNG)

## Part 3. Настройка сети ОС <a name="Part_3"></a>
1. Задаем название машины **user-1**.
```
hostnamectl set-hostname user-1
```

2. Устанавливаем временную зону, соответствующую нашему местоположению.
```
sudo timedatectl set-timezone Etc/GMT+5
```

3. Выводим названия сетевых интерфейсов с помощью консольной команды.

    ![Вывод команды ip](../misc/screenshots/Part3_1.PNG)

    - lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost. Посмотреть привязку можно в файле */etc/hosts*.

4. Используя консольную команду, получаем ip адрес текущего устройства от DHCP сервера.

    ![ip адрес устройства](../misc/screenshots/Part3_4.PNG)

    - DHCP (Dynamic Host Configuration Protocol) - протокол динамической настройки узла

5. Определяем и выводим на экран внешний и внутренний ip-адрес шлюза.

    - Внутренний ip узнаем через команду: `ip addr`

    ![Вывод команды curl](../misc/screenshots/Part3_4.PNG)

    - Внешний ip узнаем через команду: `curl ifconfig.me`

    ![Вывод команды ip addr](../misc/screenshots/Part3_5.PNG)

    - ip порта, который принимает пакеты от нашей машины (роутер/компьютер, на котором стоит VB) узнаем через команду `ip route`

    ![ip порта, принимающего трафик с текущей машины](../misc/screenshots/Part3_5_3.PNG)

6. Задаем статичные настройки ip, gw, dns (используем публичные DNS серверы)
    - Для этого находим файл конфигурации Netplan. Обычно он находится в `/etc/netplan/` и имеет расширение `.yaml`.

    ![Файл конфигураций "до"](../misc/screenshots/Part3_6.PNG)

    - Редактируем его через `sudo vim /etc/netplan/00-installer-config.yaml`

    ![Файл конфигураций "после"](../misc/screenshots/Part3_6_2.PNG)

    - Сохраняем отредактированный файл и применяем команду `sudo netplan apply`
    
7. Перезагружаем виртуальную машину для проверки заданных значений статичных сетевых настроек
    - Выполняем команду `sudo reboot` и пингуем удаленные хосты 1.1.1.1 и ya.ru

    ![Пинг 1.1.1.1](../misc/screenshots/Part3_7.PNG)
    
    ![Пинг ya.ru](../misc/screenshots/Part3_7_2.PNG)

## Part 4. Обновление ОС <a name="Part_4"></a>
Для обновления пакетов пишем в терминал команду: `sudo apt upgrade`. Для проверки вводим команду еще раз:

![Сообщение о том, что обновления отсутствуют](../misc/screenshots/Part4.PNG)

## Part 5. Использование команды sudo <a name="Part_5"></a>
 **sudo** (substitute user and do — дословно «подменить пользователя и выполнить») — команда, позволяющая юзеру использовать привилегии root
 
 Добавляем созданного пользователя в группу *sudo*: `sudo usermod -aG sudo user1_adm`

 Меняем hostname ОС от имени этого пользователя:
 - Переключаемся на созданного пользователя командой `su - user1_adm`
 - Меняем название на *s21* командой `sudo hostnamectl set-hostname s21` и переключаемся на "нашего" пользователя для проверки изменения hostname (также можно ввести команды `hostname` или `hostnamectl`)

 ![Скрин выполненных команд](../misc/screenshots/Part5.PNG)

## Part 6. Установка и настройка службы времени <a name="Part_6"></a>
Включаем автоматическую синхронизацию времени с удаленными серверами NTP: `sudo timedatectl set-ntp true`

Выводим время часового пояса, в котором мы сейчас находимся: `timedatectl show`

![Настройка службы времени](../misc/screenshots/Part6.PNG)

## Part 7. Установка и использование текстовых редакторов <a name="Part_7"></a>
Устанавливаем текстовые редакторы **Vim**, **Nano** и **Joe**:

  `sudo apt install vim`

  `sudo apt install nano`

  `sudoapt install joe`

1. Создаем файл *test_X.txt*, где Х - название редактора. Записываем свой никнейм и зарываем файл с сохранением изменений:
    - Vim
        - Нажимаем `i` (insert) для перехода в режим редактирования.
        - Записываем никнейм.
        - Выходим из режима вставки, нажав `esc`
        - Пишем `:wq` для закрытия файла с сохранением

            ![Vim никнейм](../misc/screenshots/Part7_vim_1.PNG)

    - Nano
        - Пишем никнейм
        - Для сохранения нажимаем `ctrl + s`
        - Для выхода нажимаем `ctrl + x`
        
            ![Nano никнейм](../misc/screenshots/Part7_nano_1.PNG)

    - Joe
        - Пишем никнейм
        - Для сохранения нажимаем `ctrl + k - w`
        - Подверждаем сохранение, нажав `enter`
        - Нажимаем `ctrl + c` для выхода

            ![Joe никнейм](../misc/screenshots/Part7_joe_1.PNG)

2. Редактируем файлы, заменив никнейм на "**21 School 21**" и закрываем файлы без сохранения изменений
    - Vim
        - Нажимаем `i` (insert) для перехода в режим редактирования.
        - Записываем *21 School 21*.
        - Выходим из режима вставки, нажав `esc`
        - Пишем `:q!` для закрытия файла без сохранения

            ![Vim замена без сохранения](../misc/screenshots/Part7_vim_2.PNG)

    - Nano
        - Пишем *21 School 21*
        - Для выхода нажимаем `ctrl + x`
        - Подтверждаем выход без сохранения, нажав `n`

            ![Nano замена без сохранения](../misc/screenshots/Part7_nano_2.PNG)

    - Joe
        - Пишем *21 School 21*
        - Нажимаем `ctrl + c` для выхода
        - Подтверждаем выход без сохранения, нажав `y`
        
            ![Joe замена без сохранения](../misc/screenshots/Part7_joe_2.PNG)

3. Редактируем файлы ещё раз (по аналогии с предыдущим пунктом), а затем с помощью функции поиска по содержимому файла заменяем искомое слово на любое другое
    - Vim
        - Нажимаем `i` (insert) для перехода в режим редактирования.
        - Записываем *21 School 21*.
        - Выходим из режима вставки, нажав `esc`
        - Пишем `/School`

            ![Vim нахождение слова](../misc/screenshots/Part7_vim_3.PNG)

        - Пишем `:s/School/JODYVOLE`
        - Пишем `:wq` для закрытия файла с сохранением
        
            ![Vim замена слова](../misc/screenshots/Part7_vim_32.PNG)

    - Nano
        - Пишем *21 School 21*
        - Для поиска нажимаем `ctrl + w`

            ![Nano нахождение слова](../misc/screenshots/Part7_nano_3.PNG)

        - Пишем `ctrl + \`, вводим искомое слово `21` и затем вводим заменяющее слово `jodyvole` и указываем замену всего нажатием `a`

            ![Nano замена слова](../misc/screenshots/Part7_nano_32.PNG)

        - Для сохранения нажимаем `ctrl + s`
        - Для выхода нажимаем `ctrl + x`

    - Joe
        - Пишем *21 School 21*
        - Для поиска нажимаем `ctrl + k - f`

            ![Joe поиск слова](../misc/screenshots/Part7_joe_3.PNG)
        
        - Чтобы заменить слово сразу пишем `r` и в следуещей строке пишем слово, на которое нужно заменить искомое слово `21` и подтверждаем замену введя `y`
        - И при выходе из файла подтверждаем сохранение файла `y`

            ![Joe замена слова](../misc/screenshots/Part7_joe_32.PNG)

## Part 8. Установка и базовая настройка сервиса SSHD <a name="Part_8"></a>
Для установки службы SSH пишем команду: `sudo apt install openssh-server`

Для автостарта службы при загрузке системы используем команду **enable**: `sudo sustemctl enable ssh`

Убеждаемся в том, что служба автостарта активирована

![Скрин статауса ssh](../misc/screenshots/Part8.PNG)

Перенастраиваем службу SSHd на другой порт путем редактирования файла конфигураций SSHd (/etc/ssh/sshd_config)

![Отредактированный файл конфигураций](../misc/screenshots/Part8_2.PNG)

Для применения сделанных настроек перезапускаем SSH-сервер командой `sudo systemctl restart ssh`

Проверяем наличие процесса sshd через команду `ps` (показывает активные процессы системы и информацию о них) с флагами `-e` (отображает все процессы на системе, эквивалентно `-A`) и `-f` (показывает больше информации о каждом процессе)

![Наличие процесса службы SSHd](../misc/screenshots/Part8_3.PNG)

Перезагружаем систему командой `sudo reboot`

Проверяем сетевую конфигурацию командой `netstat -tan`
  - `-t` или `--tcp` - отображает TCP соединения
  - `-a` или `--all` - показывает все соединения
  - `-n` или `--numeric` - отображает адреса и номера портов в числовом формате

![Сетевая конфигурация](../misc/screenshots/Part8_4.PNG)

  - *Proto* - протокол соединения
  - *Rec-Q* - количеству байтов данных, которые ожидают обработки в очередях приема
  - *Send-Q* -  количеству байтов данных, которые ожидают обработки в очередях отправки
  - *Local Address* - локальный адрес и порт (<ip-адрес>:<порт>)
  - *Foreign Address* - удаленный адрес и порт (<ip-адрес>:<порт>)
  - *State* - состояние соединения

Значение 0.0.0.0 в контексте сетевого программирования и конфишурации сетевых сервисов используется для обозначения "любого" или "всех" IP-адресов, доступных на машине

## Part 9. Установка и использование утилит top, htop <a name="Part_9"></a>
Утилита **top** предустановлена во всех дистрибутивах Linux и не требует отдельной установки

Устанавливаем утилиту **htop**: `sudo apt install htop`

- Вывод утилиты **top**

    ![Скрин выполнения команды top](../misc/screenshots/Part9.PNG)
    
    * uptime: 14 min
    * Количество авторизованных пользователей: 1 (jodyvole)
    * Общая загрузка системы (1/5/15 min): 0.00 / 0.02 / 0.04
    * Общее количество процессов (Tasks): 104
    * Загрузка cpu: 0.2 us (пользовательские процессы), 0.2 sy (процессы ядра), 99.7 id (неиспользуемые ресурсы), 0.0 wa (операции ввода/вывода, т.е. дисковые операции)
    * Mem/Swap: 3920.0/2295.0 (общий объем), 3476.9/2295.0 (свободная память), 151.6/0.0 (использованная память)
    * pid процесса, занимающего больше всего памяти: **690** (нажимаем `M`)
    * pid процесса, занимающего больше всего процессорного времени: **1141** (используется по умолчания, но можно нажать `P`)

- Отсортированный вывод команды **htop**:

    - по **PID**

        ![Сортированый вывод htop по pid](../misc/screenshots/Part9_htop1.PNG)

    - по **PERCENT_CPU**

        ![Сортированый вывод htop по cpu](../misc/screenshots/Part9_htop2.PNG)

    - по **PERCENT_MEM**

        ![Сортированный вывод htop по mem](../misc/screenshots/Part9_htop3.PNG)
    
    - по **TIME**

        ![Сортированный вывод htop по time](../misc/screenshots/Part9_htop4.PNG)

- Отфильтрованный вывод команды **htop** для процесса **sshd**:

    ![Отфильрованный вывод htop](../misc/screenshots/Part9_htop_2.PNG)

- Вывод **htop** с процессом *syslog*, используя поиск

    ![Вывод htop, используя поиск](../misc/screenshots/Part9_htop_3.PNG)

- Вывод **htop** с добавленным выводом *hostname*, *clock* и *uptime*

    Для этого заходим в настройки (`f2`), выбираем подменю `Meters` и добавляем в `Right column` для отображения следующие столбцы: *Hostname*, *Clock* и *Uptime*
    
    *Отображается в верхнем окне, в правой нижней части

    ![Отображение htop с добавленным выводом](../misc/screenshots/Part9_htop_4.PNG)

## Part 10. Использование утилиты fdisk <a name="Part_10"></a>
Запускаем команду `sudo fdisk -l`

![Вывод команды fdisk](../misc/screenshots/Part10.PNG)

Из вывода команды можно заключить, что:
  * ЖД называется **dev/sda** (dev/sda3)
  * ЖД имеет размер **25 Gb** и **52428800** секторов
  * Раздел подкачи реализован как файл на одном из разделов, а не как отдельный раздел и имеет название **/dev/sda2** и его размер составляет **2 Gb**. Для уточнения информации о **swap** в этом случае используем команду `swapon --show`:

    ![Информация о swap](../misc/screenshots/Part10_swap.PNG)

    Размер **swap** составляет **2.2 Gb**

## Part 11. Использование утилиты df <a name="Part_11"></a>
Для получения подробного отчета об использовании дискового пространства для корневого раздела системы (/) используем команду `df /`

![Информация об использовании дискового пространства](../misc/screenshots/Part11.PNG)

  * Размер раздела: 11758760
  * Размер занятого пространства: 5156352
  * Размер свободного пространства: 5983300
  * Процент использования: 47

Единица измерения: 1K-blocks (блоки по 1 килобайту)

Чтобы получить информацию о дисковом пространстве для всех смонтированных файловых систем пишем команду `df -Th`

![Информация о дисковом пространстве для файловых систем](../misc/screenshots/Part11_2.PNG)

Для определения корневого раздела ищем строку, где в столбце *Mounted on* указано **/**. Это информация о корневом разделе

  * Размер раздела: 12 G
  * Размер занятого пространства: 5.0G
  * Размер свободного пространства: 5.8 G
  * Процент использования: 47

Тип файловой системы для раздела - **ext4**

## Part 12. Использование утилиты du <a name="Part_12"></a>
Используя команду `du`

  * выводим размер папки **/home**

    ![Вывод команды du /home](../misc/screenshots/Part12_1.PNG)

  * выводим размер папки **/var**

    ![Вывод команды du /var](../misc/screenshots/Part12_2.PNG)

  * выводим размер папки **/var/log**

    ![Вывод команды du /var/log](../misc/screenshots/Part12_3.PNG)

  * выводим размер всего содержимого в **/var/log**

    ![Вывод команды du /var/log/*](../misc/screenshots/Part12_4.PNG)

## Part 13. Установка и использование утилиты ncdu <a name="Part_13"></a>
Устанавливаем **ncdu** командой `sudo apt-get install ncdu`

Используя команду **ncdu**

  * выводим размер папки **/home**

    ![Вывод команды ncdu /home](../misc/screenshots/Part13_1.PNG)

  * выводим размер папки **/var**

    ![Вывод команды ncdu /var](../misc/screenshots/Part13_2.PNG)

  * выводим размер папки **/var/log**

    ![Вывод команды ncdu /var/log](../misc/screenshots/Part13_3.PNG)


## Part 14. Работа с системными журналами <a name="Part_14"></a>
Открываем для просмотра:

  1. **/var/log/dmesg**
  2. **/var/log/syslog**
  3. **/var/log/auth.log**

чтобы найти время последней успешной авторизации, имя пользователя и метод входа в систему

* Последняя успешная авторизация: *Aug 24 09:21:43*
* Имя пользователя: *jodyvole*
* Метод входа в систему: *LOGIN*

Перезапускаем службу SSHd командой `sudo systemctl restart sshd` и ищем информацию о рестарте в логах

![Логи завершения и старта SSHd](../misc/screenshots/Part14.PNG)

## Part 15. Использование планировщика заданий CRON <a name="Part_15"></a>
Для работы **cron** нужен *crontab-файл*. По умолчанию он не существует, поэтому создвем его вручную командой `crontab -e`, выбираем **vim** и добавляем запись.

Выводим на экран список текущих заданий для **cron**:

![Добавление задачи в cron](../misc/screenshots/Part15.PNG)

Проверяем работу **cron**'а через логи командой `tail -n 100 /var/log/syslog`:

![Логи сзаписями о работе CRON](../misc/screenshots/Part15_2.PNG)

Удаляем все задачи из **cron**'а командой `crontab -e` (также можно использовать команду `crontab -r`). Автоматически переходим в вим, удаляем запись и выходим с сохранением.

Вывод команды `crontab -l`:

![Настройки файла cron](../misc/screenshots/Part15_3.PNG)